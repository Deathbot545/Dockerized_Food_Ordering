@{
    ViewData["Title"] = "Guest Menu";
}
<style>
    /* General Styles */
    body {
        font-family: 'Roboto', sans-serif;
        background-color: #f8f8f8;
    }

    .container {
        margin-top: 20px;
    }

    .outlet-header {
        text-align: center;
        margin: 20px 0;
        padding: 20px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    #outlet-name {
        font-size: 2em;
        font-weight: 700;
    }

    #outlet-logo {
        border-radius: 50%;
        max-width: 100px;
        margin-top: 15px;
    }

    /* Navbar styles */
    .custom-navbar {
        background-color: #fff;
        padding: 10px 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
        margin-bottom: 20px;
    }

    .custom-navbar .navbar-nav .nav-link {
        color: #333;
        font-weight: 500;
        padding: 10px 15px;
        margin: 5px;
        border-radius: 5px;
        transition: color 0.3s ease, background-color 0.3s ease;
    }

    .custom-navbar .navbar-nav .nav-link:hover,
    .custom-navbar .navbar-nav .nav-link:focus {
        color: #fff;
        background-color: #ff6347;
    }

    /* Call Waiter button in the navbar */
    .call-waiter-nav-button {
        background-color: #3498DB;
        color: #fff;
        border: none;
        padding: 10px 20px;
        font-size: 1em;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.3s ease;
        border-radius: 5px;
        margin-left: 10px;
    }

    .call-waiter-nav-button:hover {
        background-color: #2980B9;
    }

    /* Card styles */
    .card {
        background-color: #fff;
        border: none;
        border-radius: 15px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        transition: transform 0.3s ease;
        margin-bottom: 30px;
    }

    .card:hover {
        transform: scale(1.05);
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
    }

    .card-img-top {
        width: 100%;
        height: 150px;
        object-fit: cover;
    }

    .card-body {
        padding: 15px;
        text-align: center;
    }

    .card-title {
        font-size: 1.2em;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .card-text {
        color: #666;
        margin-bottom: 15px;
    }

    /* Cart button styles */
    .cart-fixed-bottom {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: #343a40;
        color: #fff;
        padding: 10px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
    }

    /* Hide the cart button initially */
    #cart-button {
        display: none;
    }

    /* Style adjustments for better mobile responsiveness */
    @@media (max-width: 768px) {
        .outlet-header {
            padding: 10px;
        }

        .outlet-header img {
            max-width: 100%;
            height: auto;
        }

        .outlet-header h1 {
            font-size: 1.5em;
        }
    }
</style>

<div class="outlet-header">
    <h1 id="outlet-name">Outlet Name</h1>
    <img id="outlet-logo" src="your-logo-url.jpg" alt="Outlet Logo">
</div>

<nav class="navbar navbar-expand-lg custom-navbar">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse d-flex justify-content-between align-items-center" id="navbarNav">
        <ul class="navbar-nav" id="category-navbar">
            <!-- Categories will be filled here by JavaScript -->
        </ul>
        <button class="btn call-waiter-nav-button">Call Waiter</button>
    </div>
</nav>

<div id="menu-container" class="container">
    <!-- This will be populated by JavaScript -->
</div>

<div id="cart-button" class="cart-fixed-bottom">
    <div>
        <span id="cart-items-count">0</span> Items - LKR <span id="cart-total">0.00</span>
    </div>
    <button class="btn btn-primary call-waiter-button">Call Waiter</button>
</div>

<script>
    $(document).ready(function () {
        let outletId = '@ViewBag.OutletId';
        let tableId = '@ViewBag.TableId'; // Assuming tableId is available in ViewBag

        const connection = new signalR.HubConnectionBuilder()
            .withUrl("https://restosolutionssaas.com/api/OrderApi/orderStatusHub")
            .build();

        connection.start().then(function () {
            console.log("SignalR connection established");
        }).catch(function (err) {
            console.error("SignalR connection error:", err);
        });

        function fetchAndDisplayMenuItems() {
            let apiEndpoint = `https://restosolutionssaas.com/api/MenuApi/GetMenuItems/${outletId}`;
            $.get(apiEndpoint, function (menuItems) {
                let categoryMap = {};
                let navbarItems = '';

                console.log("Fetched Menu Items:", menuItems); // Log menu items

                menuItems.forEach(menuItem => {
                    console.log("Menu Item:", menuItem); // Log each menu item

                    if (!categoryMap[menuItem.menuCategoryId]) {
                        categoryMap[menuItem.menuCategoryId] = { name: menuItem.categoryName, items: [] };
                    }
                    categoryMap[menuItem.menuCategoryId].items.push(menuItem);
                });

                let menuHtml = '';

                Object.keys(categoryMap).forEach(categoryId => {
                    const category = categoryMap[categoryId];
                    navbarItems += `<li class="nav-item"><a class="nav-link" href="#${categoryId}">${category.name}</a></li>`;

                    menuHtml += `<div id="${categoryId}">
                                     <h2>${category.name}</h2>
                                     <div class="row">`;

                    category.items.forEach(menuItem => {
                        const imageBase64 = menuItem.image;
                        menuHtml += `<div class="col-md-4">
                                         <div class="card" data-item-id="${menuItem.id}" data-category-id="${menuItem.menuCategoryId}" data-outlet-id="${outletId}" data-table-id="${tableId}">
                                             <img src="data:image/png;base64,${imageBase64}" class="card-img-top" alt="${menuItem.name}">
                                             <div class="card-body">
                                                 <h5 class="card-title">${menuItem.name} - LKR ${menuItem.price.toFixed(2)}</h5>
                                                 <p class="card-text">${menuItem.description}</p>
                                             </div>
                                         </div>
                                     </div>`;
                    });

                    menuHtml += `</div>
                                 </div>`;
                });

                $('#category-navbar').html(navbarItems);
                $('#menu-container').html(menuHtml);
            })
                .fail(function (jqXHR, textStatus, errorThrown) {
                    console.log("Request failed:", textStatus, errorThrown);
                });
        }

        function fetchAndDisplayOutletInfo() {
            let outletInfoEndpoint = `https://restosolutionssaas.com/api/OutletApi/outletInfo/${outletId}`;

            console.log(`Fetching data from endpoint: ${outletInfoEndpoint}`); // Logs the endpoint being hit.

            $.get(outletInfoEndpoint, function (outletInfo) {
                console.log('Received data:', outletInfo); // Logs the received data.

                // Set the outlet name in the title
                if (outletInfo && outletInfo.customerFacingName) {
                    console.log('Setting customerFacingName:', outletInfo.customerFacingName); // Logs the name being set.
                    $('#outlet-name').text(outletInfo.customerFacingName);
                }

                // Set the logo in the image element
                if (outletInfo && outletInfo.logo) {
                    console.log('Setting logo:', outletInfo.logo); // Logs the logo being set.
                    $('#outlet-logo').attr('src', `data:image/png;base64,${outletInfo.logo}`);
                }
            }).fail(function (jqXHR, textStatus, errorThrown) {
                console.log("Request failed:", textStatus, errorThrown); // Logs failure reason.
            });
        }

        fetchAndDisplayMenuItems();
        fetchAndDisplayOutletInfo();
    });
</script>


